<?php
$input  = 'finalReportTemplate/finalReportTemplate.docx';
$output = 'finalReportTemplate/finalReport.docx';

$tableRow = "<w:tr w:rsidR=\"00BA0E29\" w:rsidRPr=\"00722CA6\" w14:paraId=\"44E813C0\" w14:textId=\"77777777\" w:rsidTr=\"00DE15AE\"><w:trPr><w:trHeight w:val=\"315\"/></w:trPr><w:tc><w:tcPr><w:tcW w:w=\"853\" w:type=\"pct\"/><w:tcBorders><w:top w:val=\"single\" w:sz=\"4\" w:space=\"0\" w:color=\"auto\"/><w:left w:val=\"single\" w:sz=\"8\" w:space=\"0\" w:color=\"auto\"/><w:bottom w:val=\"single\" w:sz=\"4\" w:space=\"0\" w:color=\"auto\"/><w:right w:val=\"single\" w:sz=\"4\" w:space=\"0\" w:color=\"auto\"/></w:tcBorders><w:shd w:val=\"clear\" w:color=\"000000\" w:fill=\"D9D9D9\"/><w:noWrap/><w:vAlign w:val=\"center\"/><w:hideMark/></w:tcPr><w:p w14:paraId=\"7696B97A\" w14:textId=\"305BF026\" w:rsidR=\"00952C4F\" w:rsidRPr=\"00722CA6\" w:rsidRDefault=\"00DE15AE\" w:rsidP=\"002B0D49\"><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:rFonts w:asciiTheme=\"minorHAnsi\" w:hAnsiTheme=\"minorHAnsi\" w:cstheme=\"minorHAnsi\"/><w:b/><w:bCs/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:asciiTheme=\"minorHAnsi\" w:hAnsiTheme=\"minorHAnsi\" w:cstheme=\"minorHAnsi\"/><w:b/><w:bCs/></w:rPr><w:t>{Finding-ID-1}</w:t></w:r></w:p></w:tc><w:tc><w:tcPr><w:tcW w:w=\"1783\" w:type=\"pct\"/><w:tcBorders><w:top w:val=\"single\" w:sz=\"4\" w:space=\"0\" w:color=\"auto\"/><w:left w:val=\"nil\"/><w:bottom w:val=\"single\" w:sz=\"4\" w:space=\"0\" w:color=\"auto\"/><w:right w:val=\"single\" w:sz=\"4\" w:space=\"0\" w:color=\"auto\"/></w:tcBorders><w:shd w:val=\"clear\" w:color=\"000000\" w:fill=\"D9D9D9\"/><w:vAlign w:val=\"center\"/><w:hideMark/></w:tcPr><w:p w14:paraId=\"0F568146\" w14:textId=\"06833DFC\" w:rsidR=\"007714D1\" w:rsidRDefault=\"00DE15AE\"><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:rFonts w:asciiTheme=\"minorHAnsi\" w:eastAsia=\"Times New Roman\" w:hAnsiTheme=\"minorHAnsi\" w:cstheme=\"minorHAnsi\"/><w:b/><w:bCs/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:asciiTheme=\"minorHAnsi\" w:eastAsia=\"Times New Roman\" w:hAnsiTheme=\"minorHAnsi\" w:cstheme=\"minorHAnsi\"/><w:b/><w:bCs/></w:rPr><w:t>{Finding-Description-1}</w:t></w:r></w:p></w:tc><w:tc><w:tcPr><w:tcW w:w=\"887\" w:type=\"pct\"/><w:tcBorders><w:top w:val=\"single\" w:sz=\"4\" w:space=\"0\" w:color=\"auto\"/><w:left w:val=\"single\" w:sz=\"4\" w:space=\"0\" w:color=\"auto\"/><w:bottom w:val=\"single\" w:sz=\"4\" w:space=\"0\" w:color=\"auto\"/><w:right w:val=\"single\" w:sz=\"4\" w:space=\"0\" w:color=\"auto\"/></w:tcBorders><w:shd w:val=\"clear\" w:color=\"auto\" w:fill=\"{Color-1}\"/><w:vAlign w:val=\"center\"/><w:hideMark/></w:tcPr><w:p w14:paraId=\"04AA08F7\" w14:textId=\"66FFA53A\" w:rsidR=\"007714D1\" w:rsidRDefault=\"00DE15AE\"><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:rFonts w:asciiTheme=\"minorHAnsi\" w:hAnsiTheme=\"minorHAnsi\" w:cstheme=\"minorHAnsi\"/><w:b/><w:bCs/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:asciiTheme=\"minorHAnsi\" w:hAnsiTheme=\"minorHAnsi\" w:cstheme=\"minorHAnsi\"/><w:b/><w:bCs/></w:rPr><w:t>{Finding-Likelihood-1}</w:t></w:r></w:p></w:tc><w:tc><w:tcPr><w:tcW w:w=\"887\" w:type=\"pct\"/><w:tcBorders><w:top w:val=\"single\" w:sz=\"4\" w:space=\"0\" w:color=\"auto\"/><w:left w:val=\"single\" w:sz=\"4\" w:space=\"0\" w:color=\"auto\"/><w:bottom w:val=\"single\" w:sz=\"4\" w:space=\"0\" w:color=\"auto\"/><w:right w:val=\"single\" w:sz=\"4\" w:space=\"0\" w:color=\"auto\"/></w:tcBorders><w:shd w:val=\"clear\" w:color=\"auto\" w:fill=\"{Color-2}\"/><w:vAlign w:val=\"center\"/><w:hideMark/></w:tcPr><w:p w14:paraId=\"0A26977E\" w14:textId=\"2A60C622\" w:rsidR=\"007714D1\" w:rsidRDefault=\"00DE15AE\"><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:rFonts w:asciiTheme=\"minorHAnsi\" w:hAnsiTheme=\"minorHAnsi\" w:cstheme=\"minorHAnsi\"/><w:b/><w:bCs/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:asciiTheme=\"minorHAnsi\" w:hAnsiTheme=\"minorHAnsi\" w:cstheme=\"minorHAnsi\"/><w:b/><w:bCs/></w:rPr><w:t>{Finding-</w:t></w:r><w:r><w:rPr><w:rFonts w:asciiTheme=\"minorHAnsi\" w:hAnsiTheme=\"minorHAnsi\" w:cstheme=\"minorHAnsi\"/><w:b/><w:bCs/></w:rPr><w:t>Impact</w:t></w:r><w:r><w:rPr><w:rFonts w:asciiTheme=\"minorHAnsi\" w:hAnsiTheme=\"minorHAnsi\" w:cstheme=\"minorHAnsi\"/><w:b/><w:bCs/></w:rPr><w:t>-1}</w:t></w:r></w:p></w:tc><w:tc><w:tcPr><w:tcW w:w=\"589\" w:type=\"pct\"/><w:tcBorders><w:top w:val=\"single\" w:sz=\"4\" w:space=\"0\" w:color=\"auto\"/><w:left w:val=\"single\" w:sz=\"4\" w:space=\"0\" w:color=\"auto\"/><w:bottom w:val=\"single\" w:sz=\"4\" w:space=\"0\" w:color=\"auto\"/><w:right w:val=\"single\" w:sz=\"8\" w:space=\"0\" w:color=\"auto\"/></w:tcBorders><w:shd w:val=\"clear\" w:color=\"auto\" w:fill=\"{Color-3}\"/><w:vAlign w:val=\"center\"/><w:hideMark/></w:tcPr><w:p w14:paraId=\"058E7340\" w14:textId=\"4685A954\" w:rsidR=\"007714D1\" w:rsidRDefault=\"00DE15AE\"><w:pPr><w:jc w:val=\"center\"/><w:rPr><w:rFonts w:asciiTheme=\"minorHAnsi\" w:hAnsiTheme=\"minorHAnsi\" w:cstheme=\"minorHAnsi\"/><w:b/><w:bCs/></w:rPr></w:pPr><w:r><w:rPr><w:rFonts w:asciiTheme=\"minorHAnsi\" w:hAnsiTheme=\"minorHAnsi\" w:cstheme=\"minorHAnsi\"/><w:b/><w:bCs/></w:rPr><w:t>{Finding-</w:t></w:r><w:r><w:rPr><w:rFonts w:asciiTheme=\"minorHAnsi\" w:hAnsiTheme=\"minorHAnsi\" w:cstheme=\"minorHAnsi\"/><w:b/><w:bCs/></w:rPr><w:t>Risk</w:t></w:r><w:r><w:rPr><w:rFonts w:asciiTheme=\"minorHAnsi\" w:hAnsiTheme=\"minorHAnsi\" w:cstheme=\"minorHAnsi\"/><w:b/><w:bCs/></w:rPr><w:t>-1}</w:t></w:r></w:p></w:tc></w:tr>";

$findings = [
    [1, "This is a test", "VH", "H", "M"],
    [1, "This is a test", "INFO", "INFO", "INFO"],
    [1, "This is a test", "VH", "H", "M"],
];

$replace = [
    '{Current-Date-1}' => 'testing',
    '{System-Name-1}' => 'testing',
    '{Event-Type-1}' => 'testing',
    $tableRow => generateTableListOfFindings($tableRow, $findings)
];

$leadAnalyst = [
    "Jimmy", 
    "Jimmy"
];

$allAnalyst = [
    ["Jim", "Jim"],
    ["Kyle", "Kyle"],
];

editWordDocument($input, $output, $replace);

function editWordDocument($input, $output, $replacements){
    if(copy($input, $output)){
        $zip = new ZipArchive();

        if($zip->open($output, ZipArchive::CREATE) !== true){
            return false;
        }

        $xml = $zip->getFromName('word/document.xml');
        $xml = str_replace(array_keys($replacements), array_values($replacements), $xml);

        if(false === $zip->addFromString('word/document.xml', $xml)){
            return false;
        }
        $zip->close();
        return true;

    } return false;
}

function turnAnalystNamesArrayIntoString($leadAnalyst, $allAnalyst){
    $newStr = "";
    $newStr .= $leadAnalyst[0] . " " . $leadAnalyst[1] . ", ";
    foreach($allAnalyst as $analyst){
        $newStr .= $analyst[0] . " " . $analyst[1] . ", ";
    }
    return substr($newStr, 0, -2);
}

function generateTableListOfFindings($tableRowTemplate, $findings){
    $newTable = "";
    foreach($findings as $finding){
        $tableR = $tableRowTemplate;
        $replacements  = [
            '{Finding-ID-1}'          => $finding[0],
            '{Finding-Description-1}' => $finding[1],
            '{Finding-Likelihood-1}'  => $finding[2],
            '{Finding-Impact-1}'      => $finding[3],
            '{Finding-Risk-1}'        => $finding[4],
            '{Color-1}'               => colorSelector($finding[2]),
            '{Color-2}'               => colorSelector($finding[3]),
            '{Color-3}'               => colorSelector($finding[4])
        ];

        $tableR   = str_replace(array_keys($replacements), array_values($replacements), $tableR);
        $newTable .= $tableR; 
    }

    return $newTable;
}

function colorSelector($type){
    $type = strtolower($type);
    switch($type){
        case "vh":
            return "FF0000";
        case "h":
            return "FFC000";
        case "m":
            return "FFBF8F";
        case "l":
            return "FFFF00";
        case "vl":
            return "92D050";
        case "info":
            return "0070C0";
        default:
            return "D9D9D9";        
    }
}
?>